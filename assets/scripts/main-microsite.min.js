"use strict";function getPrimaryStats(e){var t="https://osm-stats-production-api.azurewebsites.net/countries/"+e;$.getJSON(t,function(e){if(null!==e.all_edits){var t=Math.round(e.contributors),a=Math.round(e.all_edits),n=Math.round(e.building_count_add),s=Math.round(e.road_count_add);$("#stats-roadCount").html(s.toLocaleString()),$("#stats-buildingCount").html(n.toLocaleString()),$("#stats-usersCount").html(t.toLocaleString()),$("#stats-editsCount").html(a.toLocaleString())}else $(".emphasizedNumber").css("display","none")})}function getProjects(e){$(".Projects-slider").flexslider({animation:"slide",directionNav:!0,slideshowSpeed:6e6,prevText:"",nextText:""}),$(".flex-next").prependTo(".HOT-Nav-Projects"),$(".flex-control-nav").prependTo(".HOT-Nav-Projects"),$(".flex-prev").prependTo(".HOT-Nav-Projects"),1===e.length&&$(".flex-next").css("display","none"),e.forEach(function(e,t){var a="https://tasks.hotosm.org/api/v1/project/"+e+"/summary";$.getJSON(a,function(e){makeProject(e,t+2)}).fail(function(a){makePlaceholderProject(e,t+2)})})}function makeProject(e,t){var a=Math.round(e.percentMapped);$("ul li:nth-child("+t+") .HOT-Progress").addClass("projWidth"+t),$(".HOT-Progress").append("<style>.projWidth"+t+":before{ width: "+a+"%;}</style>"),$("ul li:nth-child("+t+") .HOT-Title p").html("<b>"+e.projectId+" - "+e.name+"</b>"),$("ul li:nth-child("+t+") .title").html(e.name+" (#"+e.projectId+")"),$("ul li:nth-child("+t+") .HOT-Progress").html("<p>"+a+"%</p>"),$("ul li:nth-child("+t+") .HOT-Progress").attr("title",a+"% complete"),$("ul li:nth-child("+t+") .HOT-Details .completeness").html("<strong>"+a+"%</strong> complete"),$("ul li:nth-child("+t+") .HOT-Map").attr("id","Map-"+e.projectId),addMap(e.projectId)}function makePlaceholderProject(e,t){$("ul li:nth-child("+t+") .HOT-Title p").html('<i class="ico icon collecticon-sign-danger"></i>\n<b>HOT Project #'+e+" Not Active/Not Found in HOT Tasking Manager</b>"),$("#TM-Contribute-Btn-"+e).css("display","none"),$("#HOT-Title-"+e+" p").css("width","100%");var a="HOT Tasking Manager endpoint failure in "+PT.mainHashtag+" partner page",n="Project "+e+" is no longer indexed in the HOT\n Tasking Manager, so it should be removed from the "+PT.mainHashtag+" partner\n page variable settings.",s='Uh oh, it looks like <a href="https://tasks.hotosm.org/api/v1/project/'+project+";"+e+'"\n target="_blank">Project #'+e+'</a> has been removed from the HOT Tasking Manager.\n <a href="https://github.com/MissingMaps/partners/issues/new?title='+a+"\n &body="+n+'" target="_blank">Click here</a> to report an issue or\n <a href="https://tasks.hotosm.org/" target="_blank">here</a>\n to search for more projects.';$("ul li:nth-child("+t+") .HOT-Description p").html(s),$("ul li:nth-child("+t+") .HOT-Map").empty().addClass("placeholder"),$("ul li:nth-child("+t+") .HOT-Progress ").css("display","none")}function onEachFeature(e,t){var a={color:"black",weight:.25,opacity:.7,fillOpacity:.4,fillColor:"black"},n=e.properties.taskStatus;"READY"===n?(a.fillColor="#ffffff",a.fillOpacity=0):"INVALIDATED"===n?a.fillColor="#e90b43":"VALIDATED"===n?a.fillColor="#008000":"LOCKED_FOR_MAPPING"===n?a.fillColor="#1259F0":"MAPPED"===n&&(a.fillColor="#ffcc00"),t.setStyle(a)}function addMap(e){var t="https://tasks.hotosm.org/api/v1/project/"+e;$.getJSON(t,function(t){$("#Map-"+e).empty();var a=L.map("Map-"+e,{zoomControl:!1}).setView([38.889931,-77.009003],13);L.tileLayer(mbBasemapUrl+"?access_token="+mbToken,{attribution:'<a href="http://mapbox.com">Mapbox</a>'}).addTo(a),a.attributionControl.setPrefix("");var n=L.geoJson(t.tasks,{onEachFeature:onEachFeature}).addTo(a);a.fitBounds(n.getBounds()),a.dragging.disable(),a.touchZoom.disable(),a.doubleClickZoom.disable(),a.scrollWheelZoom.disable(),a.keyboard.disable(),a.tap&&a.tap.disable()})}function eventsFunctionality(){var e=$(".event-sub-container").length,t=!1,a=!1;3>=e&&$(".events-btn").css("display","none"),$(".events-btn").bind("click").click(function(n){t===!1&&a===!1?(t=!0,$(".hidden").slice(0,2).css("display","block").animate({opacity:1,height:"190px"},500),e>=5?$(".events-btn").html("SEE ALL"):(t=!1,a=!0,$(".events-btn").html("SEE FEWER"))):t===!0&&a===!1&&e>2?(t=!1,a=!0,$(".events-btn").html("SEE ALL"),$(".hidden").css("display","block").animate({opacity:1,height:"190px"},500),$(".events-btn").html("SEE FEWER")):t===!1&&a===!0&&(t=!1,a=!1,$(".hidden").animate({opacity:0,height:"0px"},300,function(){$(".hidden").css("display","none")}),$(".events-btn").html("SEE MORE"))})}function generateEvents(e){if(e.match(/google/)){$("#events-spinner").css("display","block");var t="https://osm-stats-production-api.azurewebsites.net/calendar/"+e+"/events",a=new Date;$.getJSON(t,function(e){if(0===e.length)$(".events-null").css("display","block"),$(".events-panel").css("display","none");else{var t=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;Object.keys(e).reverse().map(function(n,s){var r=e[n].time[0];if(moment(a).isBefore(r)){var i=e[n].name,o=e[n].description.match(t),l=e[n].description.replace(t,""),c=e[n].location,d=moment(e[n].time[0]).format("MMMM Do"),p=e[n].time.map(function(e){var t=new Date(e);return moment(t).format("h:mma")}).join(" - "),h=['<div class="card-divider event-top-section">','<div class="sub-head">','<img class="event-images" src="/assets/graphics/flags/4x3/'+PT.flag+'" width="24"/>','<h3 class="event-header">'+i+"</h3>",'<a class="btn btn-grn" href='+o+' target="">SIGN UP</a>',"</div>","</div>"].join(""),u=['<div class="textbox" style="padding-top:8px">',"<p><b>Date:</b> "+d+"</p>","<p><b>Time:</b> "+p+"</p>","<p><b>Location:</b> "+c+"</p>","<p><b>About:</b> "+l+"</p>","</div>"].join(""),m=['<div class="column">','<div class="card">',h,'<div class="card-section">',u,"</div>","</div>","</div>"].join("");$("#event-cards").append(m),$("#events-spinner").css("display","none")}})}})}else $(".events-null").css("display","block"),$(".events-panel").css("display","none");eventsFunctionality()}function setupGraphs(){function e(){var e=document.querySelector("#Team-User-Total-Graph svg"),t=document.querySelector("#Team-User-Bldng-Graph svg"),a=document.querySelector("#Team-User-Roads-Graph svg");e.parentNode.removeChild(e),t.parentNode.removeChild(t),a.parentNode.removeChild(a)}var t=($(".btn.invert-btn-grn.teams-btn"),$(".Team-Graph-Title .left")),a=$(".Team-User-Graph-Title .left");$("#Select-Users-Graph").click(function(){$("#Select-Teams-Graph").removeClass("Selected"),$("#Select-Users-Graph").addClass("Selected"),t.text("Users"),a.text("Users"),e(),getUserActivityStats(PT.iso3)}),$("#Select-Teams-Graph").click(function(){$("#Select-Users-Graph").removeClass("Selected"),$("#Select-Teams-Graph").addClass("Selected"),t.text("Teams"),a.text("Teams"),e(),getGroupActivityStats(PT.iso3),showMoreContributions()})}function generateUserUrl(e){var t="http://www.missingmaps.org/users/#/"+e.replace(/\s+/g,"-").toLowerCase();return'<a xlink:href="'+t+'" target="_blank" style="text-decoration:none">'+e+"</a>"}function getUserActivityStats(e){var t="https://osm-stats-production-api.azurewebsites.net/countries/"+e+"/users";$.getJSON(t,function(e){if(0!==e.length){var t=Object.keys(e).map(function(t){var a=Math.round(Number(e[t].all_edits));return{name:generateUserUrl(e[t].name),value:a}}).sort(function(e,t){return t.value-e.value}),a=Object.keys(e).map(function(t){var a=Math.round(Number(e[t].building_count_add));return{name:generateUserUrl(e[t].name),value:a}}).sort(function(e,t){return t.value-e.value}),n=Object.keys(e).map(function(t){var a=Math.round(Number(e[t].road_km_add));return{name:generateUserUrl(e[t].name),value:a}}).sort(function(e,t){return t.value-e.value}),s=new Barchart(t,"#Team-User-Total-Graph"),r=new Barchart(a,"#Team-User-Bldng-Graph"),i=new Barchart(n,"#Team-User-Roads-Graph"),o=$(".btn.invert-btn-grn.teams-btn");t.length>10?o.css("display","inline").animate({opacity:1},500):o.css("display","inline").animate({opacity:0},500),d3.select(window).on("resize",function(){s.resize(),r.resize(),i.resize()})}})}function generateHashtagUrl(e){var t="http://www.missingmaps.org/leaderboards/#/"+e;return'<a xlink:href="'+t+'" target="_blank" style="text-decoration: none">#'+e+"</a>"}function getGroupActivityStats(e){var t="https://osm-stats-production-api.azurewebsites.net/countries/"+e+"/hashtags";$.getJSON(t,function(e){if(0!==e.length){var t=e.reduce(function(e,t){if(!$.isEmptyObject(t)){var a=Math.round(Number(t.all_edits));e.push({name:generateHashtagUrl(t.hashtag),value:a})}return e},[]).sort(function(e,t){return t.value-e.value}),a=e.reduce(function(e,t){if(!$.isEmptyObject(t)){var a=Math.round(Number(t.building_count_add))+Math.round(Number(t.building_count_mod));e.push({name:generateHashtagUrl(t.hashtag),value:a})}return e},[]).sort(function(e,t){return t.value-e.value}),n=e.reduce(function(e,t){if(!$.isEmptyObject(t)){var a=Math.round(Number(t.road_km_add))+Math.round(Number(t.road_km_add));e.push({name:generateHashtagUrl(t.hashtag),value:a})}return e},[]).sort(function(e,t){return t.value-e.value}),s=new Barchart(t,"#Team-User-Total-Graph"),r=new Barchart(a,"#Team-User-Bldng-Graph"),i=new Barchart(n,"#Team-User-Roads-Graph"),o=$(".btn.invert-btn-grn.teams-btn");t.length>10?o.css("display","inline").animate({opacity:1},500):o.css("display","inline").animate({opacity:0},500),d3.select(window).on("resize",function(){s.resize(),r.resize(),i.resize()})}else $(".Team-User-Nav").css("display","none"),$(".Team-User-Stats").css("display","none"),$(".teams-more").css("display","none"),$(".teams-none").css("display","block"),$(".Team-User-Container h1").css("text-align","center")})}function Barchart(e,t){var a={top:0,right:0,bottom:0,left:0},n=parseInt(d3.select(t).style("width"),10);n=n-a.left-a.right;var s=220,r=60/e.length,i=(s-a.top-a.bottom)/e.length-r;if(e.length>10){r=6,i=(s-a.top-a.bottom)/10-r,s+=(r+i)*(e.length-10);var o=-((e.length-10)*(r+i))-12,l=!1;$(".teams-btn").css("display","initial").click(function(){var e=$(".Team-User-Graph > svg");l===!1?($(".teams-btn").html("SHOW INITIAL TEAMS"),e.animate({marginTop:o},300),l=!0):l===!0&&($(".teams-btn").html("SHOW MORE TEAMS"),e.animate({marginTop:0},300),l=!1)})}var c=d3.scale.linear().range([0,n]).domain([0,d3.max(e,function(e){return e.value})]),d=d3.select(t).append("svg").style("width",n+a.left+a.right+"px").style("height",s+"px").append("g").attr("transform","translate("+[a.left,a.top]+")");d3.select(d.node().parentNode).style("height",s+"px");var p=d.selectAll(".bar").data(e).enter().append("g").attr("class","bar").attr("transform",function(e,t){return"translate(0,"+t*(i+r)+")"});p.append("rect").attr("class","bars").attr("height",i).attr("width",function(e){return c(e.value)}),p.append("text").attr("class","Graph-Label-Name").attr("x",5).attr("y",i/2).attr("dy",".35em").html(function(e){return e.name}).style("fill","#606161"),p.append("text").attr("class","Graph-Label-Value").attr("x",n-20).attr("y",i/2).attr("dy",".35em").text(function(e){return e.value.toLocaleString()}).attr("text-anchor","end").style("fill","#606161"),this.resize=function(){n=parseInt(d3.select(t).style("width"),10),n=n-a.left-a.right,d3.select(t).select("svg").style("width",n+a.left+a.right+"px"),c.range([0,n]),d.selectAll("rect.bars").attr("width",function(e){return c(e.value)}),d.selectAll("text.Graph-Label-Value").attr("x",n-20)}}function showUpdatesPlaceholder(){0===$(".Updates-Content").length&&($(".updates-null").css("display","block"),$("#updates-h1").css("text-align","center"))}function makeValidation(e){var t=_.uniqBy(e.features,"properties.uid"),a=t.length;$("#Mapper-Count").html(a),t.forEach(function(e){var t='<div class="column">\n        <div class="card">\n                 <div class="center" style="">\n                    <img class="user-circle mapper-'+e.properties.uid+'" style="width:50px;margin-top:5px;" src="http://www.missingmaps.org/users/assets/graphics/osm-user-blank.jpg" />\n                    <h6><a href="http://www.missingmaps.org/users/#/'+e.properties.user+'">'+e.properties.user+'</a></h4>\n                  </div>\n                  <!--<div id="Map-Box-'+e.id+'" class="column small-2">\n                  </div>-->\n            <div class="">\n                <h6>Last Edit: '+e.properties.date.slice(0,10)+'</h6>\n                <h6>Edits: <span class="badge success edits">'+e.properties.create+'</span><span class="badge warning edits">'+e.properties.modify+'</span><span class="badge alert edits">'+e.properties["delete"]+'</span></h6>\n\n                <!--<div class="map-box">\n\n                </div>-->\n                <br>\n                <a class="btn btn-blue" href="https://osmcha.mapbox.com/changesets/'+e.id+'">Review Edit<a>\n                <a class="btn btn-blue" href="http://www.openstreetmap.org/message/new/'+e.properties.user+'">Say Hello<a>\n            </div>\n        </div>\n    </div>';$("#Validation-Data").append(t)})}function getDate(){var e=new Date,t=e.getDate()-7,a=e.getMonth()+1,n=e.getFullYear();return 10>t&&(t="0"+t),10>a&&(a="0"+a),e=n+"-"+a+"-"+t}function getValidation(e){var t=e.split(","),a=getDate(),n="https://osmcha.mapbox.com/api/v1/changesets/?page=1&page_size=15&order_by=-date&reasons=40&date__gte="+a+"&in_bbox="+t[0]+","+t[1]+","+t[2]+","+t[3];$.getJSON(n,function(e){makeValidation(e)}).fail(function(e){console.warn("No New Mappers",e)})}var mbToken="pk.eyJ1IjoiZGV2c2VlZCIsImEiOiJnUi1mbkVvIn0.018aLhX0Mb0tdtaT2QNe2Q",mbBasemapUrl="https://api.mapbox.com/v4/mapbox.light/{z}/{x}/{y}.png";"Microsites"!==PT.name&&(showUpdatesPlaceholder(),getPrimaryStats(PT.iso3),getGroupActivityStats(PT.iso3),getProjects(PT.hotProjects),generateEvents(PT.calendar),getValidation(PT.bbox),setupGraphs());
//# sourceMappingURL=maps/main-f9f62c540d.js.map